<head>
  <meta charset="UTF-8">
  <title>Portail BACO - BUS</title> <script src="https://cdn.tailwindcss.com"></script>
  
  <link href="https://cdn.jsdelivr.net/npm/geist@1.0.0/dist/fonts/geist-sans/variable/geist-sans.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/geist@1.0.0/dist/fonts/geist-mono/variable/geist-mono.css" rel="stylesheet">

  <script src="https://unpkg.com/lucide@latest" defer></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Geist Sans', 'sans-serif'], // Définit Geist Sans comme police par défaut
            mono: ['Geist Mono', 'monospace'],
          },
        },
      },
    }
  </script>
</head>
<body class="h-full">

  <div id="nav-placeholder"></div>

  <div class="container mx-auto p-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Filtrer les chauffeurs par ligne</h1>

    <div class="flex flex-wrap gap-3 mb-8" id="ligneCheckboxes">
      <label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">
        <input type="checkbox" value="L.94" onchange="updateSocieteDisplay()" class="rounded text-blue-600 focus:ring-blue-500">
        <span class="font-medium text-gray-700">L.94</span>
      </label>
      <label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">
        <input type="checkbox" value="L.124" onchange="updateSocieteDisplay()" class="rounded text-blue-600 focus:ring-blue-500">
        <span class="font-medium text-gray-700">L.124</span>
      </label>
      <label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">
        <input type="checkbox" value="L.75" onchange="updateSocieteDisplay()" class="rounded text-blue-600 focus:ring-blue-500">
        <span class="font-medium text-gray-700">L.75</span>
      </label>
      <label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">
        <input type="checkbox" value="L.96" onchange="updateSocieteDisplay()" class="rounded text-blue-600 focus:ring-blue-500">
        <span class="font-medium text-gray-700">L.96</span>
      </label>
      <label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">
        <input type="checkbox" value="L.90" onchange="updateSocieteDisplay()" class="rounded text-blue-600 focus:ring-blue-500">
        <span class="font-medium text-gray-700">L.90</span>
      </label>
      </div>

    <div class="content" id="content">
      </div>
  </div>


  <script src="js/layout.js" defer></script>
  
  <script>
    // Variable pour stocker les données chargées
    let societes = [];

    // Charger les données dès que la page est prête
    document.addEventListener('DOMContentLoaded', () => {
      fetch('data/bus.json') // Assurez-vous d'avoir créé data/bus.json
        .then(response => {
          if (!response.ok) throw new Error('Erreur réseau');
          return response.json();
        })
        .then(data => {
          societes = data; // Stocker les données dans la variable
        })
        .catch(error => {
          console.error('Erreur de chargement des données bus:', error);
          document.getElementById('content').innerHTML = "<p class='text-red-600'>Erreur: Impossible de charger les données des sociétés de bus.</p>";
        });
    });

    // Fonction pour afficher les sociétés
    function updateSocieteDisplay() {
      const lignesSelectionnees = Array.from(document.querySelectorAll('#ligneCheckboxes input:checked'))
        .map(cb => cb.value);

      const societesAffichees = societes.filter(societe =>
        societe.lignes.some(ligne => lignesSelectionnees.includes(ligne))
      );

      const container = document.getElementById('content');
      if (societesAffichees.length === 0) {
        container.innerHTML = '<p class="text-gray-600">Aucune société trouvée pour les lignes sélectionnées.</p>';
        return;
      }

      // Injection de HTML stylisé avec Tailwind
      container.innerHTML = '<div>' +
          '<h3 class="text-2xl font-semibold text-gray-800 mb-4">Sociétés concernées :</h3>' +
          '<div class="flex flex-wrap gap-3 mb-8" id="societeCheckboxes">' +
            societesAffichees.map(s =>
              `<label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">` +
                `<input type="checkbox" value="${s.nom}" onchange="updateChauffeursDisplay()" class="rounded text-blue-600 focus:ring-blue-500">` +
                `<span class="font-medium text-gray-700">${s.nom}</span></label>`
            ).join('') +
          '</div>' +
          '<div id="chauffeurs" class="mt-6"></div>' + // Conteneur pour les chauffeurs
        '</div>';
    }

    // Fonction pour afficher les chauffeurs
    function updateChauffeursDisplay() {
      const societesSelectionnees = Array.from(document.querySelectorAll('#societeCheckboxes input:checked'))
        .map(cb => cb.value);

      // Générer la liste des chauffeurs (avec le nom de la société)
      const chauffeursList = societes
        .filter(s => societesSelectionnees.includes(s.nom))
        .flatMap(s => s.chauffeurs.map(c => 
            // Création d'une "carte" pour chaque chauffeur
            `<li class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 bg-white p-4 rounded-lg border border-gray-200 shadow-sm">` +
              `<span class="font-semibold text-gray-800">${c.nom} <span class="font-normal text-gray-500">(${s.nom})</span></span>` +
              `<a href="etrali:${c.tel}" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors w-full sm:w-auto text-center">${c.tel}</a>` +
            `</li>`
        ));

      const container = document.getElementById('chauffeurs');
      if (chauffeursList.length === 0) {
        container.innerHTML = '';
      } else {
        // Injection de la liste stylisée
        container.innerHTML = '<h3 class="text-2xl font-semibold text-gray-800 mb-4">Chauffeurs à contacter :</h3>' +
          '<ul class="space-y-3 list-none p-0 max-w-md">' + 
            chauffeursList.join('') + 
          '</ul>';
      }
    }
  </script>

</body>
</html>