<!DOCTYPE html>
<html lang="fr" class="h-full bg-gray-100">
<head>
  <meta charset="UTF-8">
  <title>Taxis - Portail BACO</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-full">

  <div id="nav-placeholder"></div>

  <div class="container mx-auto p-8">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Sociétés de taxi par lieu</h1>

    <div class="flex flex-wrap gap-3 mb-8" id="lieuCheckboxes">
      <label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">
        <input type="checkbox" value="Liège" onchange="updateTaxiDisplay()" class="rounded text-blue-600 focus:ring-blue-500">
        <span class="font-medium text-gray-700">Liège</span>
      </label>
      <label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">
        <input type="checkbox" value="Mons" onchange="updateTaxiDisplay()" class="rounded text-blue-600 focus:ring-blue-500">
        <span class="font-medium text-gray-700">Mons</span>
      </label>
      <label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">
        <input type="checkbox" value="Namur" onchange="updateTaxiDisplay()" class="rounded text-blue-600 focus:ring-blue-500">
        <span class="font-medium text-gray-700">Namur</span>
      </label>
      <label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">
        <input type="checkbox" value="Enghien" onchange="updateTaxiDisplay()" class="rounded text-blue-600 focus:ring-blue-500">
        <span class="font-medium text-gray-700">Enghien</span>
      </label>
      </div>

    <div class="content" id="content">
      </div>
  </div>


  <script src="js/layout.js" defer></script>
  
  <script>
    // Variable pour stocker les données chargées
    let taxis = [];

    // Charger les données dès que la page est prête
    document.addEventListener('DOMContentLoaded', () => {
      fetch('data/taxi.json') // Assurez-vous d'avoir créé data/taxi.json
        .then(response => {
          if (!response.ok) throw new Error('Erreur réseau');
          return response.json();
        })
        .then(data => {
          taxis = data; // Stocker les données dans la variable
        })
        .catch(error => {
          console.error('Erreur de chargement des données taxis:', error);
          document.getElementById('content').innerHTML = "<p class='text-red-600'>Erreur: Impossible de charger les données des taxis.</p>";
        });
    });

    // Fonction pour afficher les sociétés
    function updateTaxiDisplay() {
      const lieuxSelectionnes = Array.from(document.querySelectorAll('#lieuCheckboxes input:checked'))
        .map(cb => cb.value);

      const taxisAffiches = taxis.filter(taxi =>
        taxi.lieux.some(lieu => lieuxSelectionnes.includes(lieu))
      );

      const container = document.getElementById('content');
      if (taxisAffiches.length === 0) {
        container.innerHTML = '<p class="text-gray-600">Aucune société trouvée pour les lieux sélectionnés.</p>';
        return;
      }

      // Injection de HTML stylisé avec Tailwind
      container.innerHTML = '<div>' +
          '<h3 class="text-2xl font-semibold text-gray-800 mb-4">Sociétés disponibles :</h3>' +
          '<div class="flex flex-wrap gap-3 mb-8" id="taxiCheckboxes">' +
            taxisAffiches.map(t =>
              `<label class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-full cursor-pointer hover:bg-gray-100 transition-all shadow-sm">` +
                `<input type="checkbox" value="${t.nom}" onchange="updateContactsDisplay()" class="rounded text-blue-600 focus:ring-blue-500">` +
                `<span class="font-medium text-gray-700">${t.nom}</span></label>`
            ).join('') +
          '</div>' +
          '<div id="contacts" class="mt-6"></div>' + // Conteneur pour les contacts
        '</div>';
    }

    // Fonction pour afficher les contacts
    function updateContactsDisplay() {
      const taxisSelectionnes = Array.from(document.querySelectorAll('#taxiCheckboxes input:checked'))
        .map(cb => cb.value);

      // Générer la liste des contacts (avec le nom de la société)
      const contactsList = taxis
        .filter(t => taxisSelectionnes.includes(t.nom))
        .flatMap(t => t.contacts.map(num => 
            // Création d'une "carte" pour chaque contact (responsive)
            `<li class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 bg-white p-4 rounded-lg border border-gray-200 shadow-sm">` +
              `<span class-><strong>${t.nom}</strong></span>` +
              `<a href="etrali:${num}" class="px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors w-full sm:w-auto text-center">${num}</a>` +
            `</li>`
        ));

      const container = document.getElementById('contacts');
      if (contactsList.length === 0) {
        container.innerHTML = '';
      } else {
        // Injection de la liste stylisée
        container.innerHTML = '<h3 class="text-2xl font-semibold text-gray-800 mb-4">Numéros à contacter :</h3>' +
          '<ul class="space-y-3 list-none p-0 max-w-md">' + 
            contactsList.join('') + 
          '</ul>';
      }
    }
  </script>

</body>
</html>